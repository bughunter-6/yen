<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>APOC Browser Controls & Permissions</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: monospace; padding: 20px; }
button { display: block; margin: 6px 0; }
pre { background: #000; color: #0f0; padding: 10px; }
</style>
</head>
<body>

<h2>APOC â€“ Browser Controls & Permission Surface</h2>
<pre id="log"></pre>

<script>
const log = m => logEl.textContent += m + "\n";
const logEl = document.getElementById("log");

/* ================= FDCM ================= */
async function fdcm() {
  if (!navigator.credentials || !window.FederatedCredential) {
    log("FDCM: NOT supported");
    return;
  }
  try {
    await navigator.credentials.get({
      federated: { providers: ["https://accounts.google.com"] }
    });
    log("FDCM: request triggered");
  } catch {
    log("FDCM: blocked / canceled");
  }
}

/* ================= Payment Request ================= */
async function payment() {
  if (!window.PaymentRequest) {
    log("Payment API: NOT supported");
    return;
  }
  const pr = new PaymentRequest(
    [{ supportedMethods: "basic-card" }],
    { total: { label: "Test", amount: { currency: "USD", value: "1.00" } } }
  );
  try {
    await pr.show();
    log("Payment UI shown");
  } catch {
    log("Payment UI dismissed");
  }
}

/* ================= Private Network Access ================= */
async function pna() {
  try {
    await fetch("http://192.168.0.1", { mode: "no-cors" });
    log("PNA: fetch attempted (check DevTools for preflight)");
  } catch {
    log("PNA: blocked");
  }
}

/* ================= Storage Access API ================= */
async function storageAccess() {
  if (!document.requestStorageAccess) {
    log("Storage Access API: NOT supported");
    return;
  }
  try {
    await document.requestStorageAccess();
    log("Storage Access: granted");
  } catch {
    log("Storage Access: denied");
  }
}

/* ================= OAuth / Federated Login Window ================= */
function oauth() {
  const w = window.open(
    "https://accounts.google.com",
    "_blank",
    "width=480,height=640"
  );
  log(w ? "OAuth window opened" : "OAuth popup blocked");
}

/* ================= Idle Detection ================= */
async function idle() {
  if (!("IdleDetector" in window)) {
    log("Idle Detection: NOT supported");
    return;
  }
  const d = new IdleDetector();
  await d.start({ threshold: 60 });
  d.onchange = () =>
    log(`Idle: ${d.userState}, Screen: ${d.screenState}`);
  log("Idle Detection started");
}

/* ================= Visibility / Focus ================= */
document.addEventListener("visibilitychange", () =>
  log("Visibility: " + document.visibilityState)
);
window.addEventListener("focus", () => log("Window focused"));
window.addEventListener("blur", () => log("Window blurred"));

/* ================= File System Access ================= */
async function fs() {
  if (!window.showOpenFilePicker) {
    log("FS Access: NOT supported");
    return;
  }
  const [h] = await showOpenFilePicker();
  const f = await h.getFile();
  log("FS Access: selected " + f.name);
}

/* ================= RP ID / WebAuthn ================= */
function rpid() {
  if (window.PublicKeyCredential) {
    log("WebAuthn supported (RP ID = origin)");
  } else {
    log("WebAuthn NOT supported");
  }
}

/* ================= AMP by AGSA ================= */
function amp() {
  log("AMP Viewer detected: " + ("viewerState" in window));
}
</script>

<button onclick="fdcm()">FDCM</button>
<button onclick="payment()">Payment API</button>
<button onclick="pna()">Private Network Access</button>
<button onclick="storageAccess()">Storage Access API</button>
<button onclick="oauth()">OAuth / Federated Login</button>
<button onclick="idle()">Idle Detection</button>
<button onclick="fs()">File System Access</button>
<button onclick="rpid()">RP ID (WebAuthn)</button>
<button onclick="amp()">AMP by AGSA</button>

</body>
</html>
